---
title: "Project 1"
author: "Kyle Tadokoro"
date: "2024-02-10"
output: html_document
comment: NA
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(plotly)
library(ggplot2)
library(formattable)

```

# Introduction to Dataset and Relevance

This document will examine and interpret what conclusions can be made using the "larger_sales_dataset.csv" obtained from Hassane Skikri through kaggle.com.  For convenience sake, we will be referring to the business this dataset comes from as BusA Sales.  The set consists of 10000 observations of 10 variables.  Though the data in this set is fictional, it represents a realistic example of data that a business may collect during standard operation.  Being able to clean, sort, and make sense of such a dataset is a skill that would be beneficial for the vast majority of businesses to employ.  
```{r comment =NA}
df = read.csv("larger_sales_dataset.csv", sep = ",", header = T)
```

### Summary of BusA Sales Data
There are a total of 10 variables in the BusA data set. The fields that we will be focusing on in this analysis will be: `Product Category`, `Total Price`, `Order Date`, `Payment Type`, and `Order Status`.  
```{r comment = NA}
summary(df)
```

Through the following commands, we are able to see that the data was taken over the span of a year from January 1st, 2023 until December 31st, 2023 as well as having 10000 unique customers (no repeated customers throughout dataset).  

```{r comment = NA}
range(df$Order.Date)
length(unique(df$Customer.ID))
```

## Questions to answer about this set

- In which category the most money is being made?

- What time of year are sales peaking for each category? Overall?

- What is the average total for orders? What does this mean regarding optimizing resource distribution? 

- What percentage of sales are refunded or cancelled?

## Where is the Money Being Made?

When taking a look at the set, we can see that BusA Sales sells items from any of 6 categories.  

- Sports & Outdoors

- Home & Kitchen

- Beauty & Health

- Books

- Electronics 

- Clothing

### Sales Generated by Each Category

```{r  comment = NA}
Yearly.Total = c(sum(df$Total.Price[df$Product.Category == "Sports & Outdoors"]), sum(df$Total.Price[df$Product.Category == "Home & Kitchen"]), sum(df$Total.Price[df$Product.Category == "Beauty & Health"]), sum(df$Total.Price[df$Product.Category == "Books"]), sum(df$Total.Price[df$Product.Category == "Electronics"]), sum(df$Total.Price[df$Product.Category == "Clothing"]))

Yearly.Total <- currency(Yearly.Total, digits = 0L)

totals = data.frame(Product.Category = c("Sports & Outdoors", "Home & Kitchen", "Beauty & Health", "Books", "Electronics", "Clothing"), Yearly.Total)
arrange(totals, desc(Yearly.Total))
max(Yearly.Total) - min(Yearly.Total)
```



### Number of Transactions
```{r comment=NA}
salesGG = ggplot(df, aes(x=Product.Category))+geom_bar(fill = c("darkred", "seagreen", "orangered", "steelblue", "royalblue", "gold"))+ labs(x = "Product Category", y = "Number of Transactions", title = "Histogram of Transactions by Category")
ggplotly(salesGG)
```
```{r echo = F, comment = NA}
catdf = data.frame(Category = c("Most Popular", "Least Popular", "Range"), Data = c("Sports & Outdoors", "Beauty & Health", "105 Transactions"))
catdf
```




### 10 Biggest & Smallest Orders

We are also able to see that the top 10 Biggest orders of the 2023 year averaged at Total Price of $2491.64. It is also worth noting that in this top ten, we see the category of Books 3 times, Beauty & Health and Electronics 2 times, and Home & Kitchen, Sports & Outdoors, and Clothing only once.  
```{r comment = NA}
topTen = arrange(select(df, Total.Price, Product.Category), desc(Total.Price))
head(topTen, n = 10)
tenAvg = round(sum(topTen$Total.Price[1:10]) / 10, digits = 2)
tenAvg
tail(topTen, n = 10)
tenAvg = round(sum(topTen$Total.Price[9991:10000]) / 10, digits = 2)
tenAvg
```


## What Time of Year are Sales the Best?
When breaking down the distribution of sales throughout the year, it immediately becomes clear that the data in this file is fictional.  With a normal set of data with variables such as ours, it is typical to expect patterns and trends to appear at different times of the year that correlate with seasons, holidays, and other factors.  However, when plotting the total price of each observation against the order date, we can see an extraordinarily consistent layout develop through the 10,000 cases.  In order to make the plot more legible, we can sort by category.  Doing so does not reduce the amount of clutter, however it does show that the distribution for each of the categories is remarkably similar to eachother with no real outliers becoming apparant.  


```{r echo=F, comment=NA}
orderDf = arrange(select(df, Order.Date, Total.Price, Product.Category), Order.Date)
myGG = ggplot(orderDf, aes(Order.Date, Total.Price, color = Product.Category)) + geom_point()
myGG
```


In order to summarize the plot above in a way that is easier understood, I took the average total for orders for each month and plotted them.  Doing so, we are able to see that there is a slight deviation in order totals with the smallest amount made per order during the middle of the year before recovering back into the later months.  When looking at the graph, it is important that we keep the y-axis in mind.  Though the difference in average order totals seems dramatic, looking at the same plot with the bottom limit of our y-axis dropped to 0, we can see that the difference between the months is quite insignificant.  


```{r comment =NA}
##Subset with sorted by Order.Date
dff = select(df, Order.Date, Total.Price, Product.Category)
dff$Order.Date = sort(format(as.Date(df$Order.Date), "%m"), decreasing = F)
dff$Order.Date = as.numeric(dff$Order.Date)

##Create vector of month totals
geeba = c()
for (i in 1:12){
  geeba = c(geeba, sum(dff$Total.Price[dff$Order.Date > (i - 1) & dff$Order.Date < (i + 1) ]))
  geeba[i] = geeba[i] / length(dff$Total.Price[dff$Order.Date > (i - 1) & dff$Order.Date < (i + 1) ])
}
monthDf = data.frame(c(1:12), geeba)
g = ggplot(monthDf, aes(c(1:12), geeba)) + geom_point() + geom_smooth(method = "loess", se = F, formula = y~x, span = 1) + labs(title = "Order Total Averages By Month", x = "Month", y = "Average Totals")
g
g + ylim(0,800)

```

Due to BusA Sales a variety of categories from which they sell their products from, it would also be beneficial for executives to understand how each of their categories are trending as well.  In the plot below, I have used the same format as the one above only this time splitting the data into six individual curves. 


```{r echo=F, warning=FALSE}
##Subset with sorted by Order.Date
dff = select(df, Order.Date, Total.Price, Product.Category)
dff$Order.Date = sort(format(as.Date(df$Order.Date), "%m"), decreasing = F)
dff$Order.Date = as.numeric(dff$Order.Date)


#Create vector of month averages for each category
spoVec = c(); homVec = c(); beaVec = c(); booVec = c(); eleVec = c(); cloVec = c(); monthVec = c(1:12)

for (i in 1:12){
  spoVec = c(spoVec, sum(dff$Total.Price[(dff$Order.Date > (i - 1) & dff$Order.Date < (i + 1) ) & (dff$Product.Category == "Sports & Outdoors")]))
  spoVec[i] = spoVec[i] / length(dff$Total.Price[(dff$Order.Date > (i - 1) & dff$Order.Date < (i + 1) ) & (dff$Product.Category == "Sports & Outdoors")])
}
for (i in 1:12){
  homVec = c(homVec, sum(dff$Total.Price[(dff$Order.Date > (i - 1) & dff$Order.Date < (i + 1) ) & (dff$Product.Category == "Home & Kitchen")]))
  homVec[i] = homVec[i] / length(dff$Total.Price[(dff$Order.Date > (i - 1) & dff$Order.Date < (i + 1) ) & (dff$Product.Category == "Home & Kitchen")])
}
for (i in 1:12){
  beaVec = c(beaVec, sum(dff$Total.Price[(dff$Order.Date > (i - 1) & dff$Order.Date < (i + 1) ) & (dff$Product.Category == "Beauty & Health")]))
  beaVec[i] = beaVec[i] / length(dff$Total.Price[(dff$Order.Date > (i - 1) & dff$Order.Date < (i + 1) ) & (dff$Product.Category == "Beauty & Health")])
}
for (i in 1:12){
  booVec = c(booVec, sum(dff$Total.Price[(dff$Order.Date > (i - 1) & dff$Order.Date < (i + 1) ) & (dff$Product.Category == "Books")]))
  booVec[i] = booVec[i] / length(dff$Total.Price[(dff$Order.Date > (i - 1) & dff$Order.Date < (i + 1) ) & (dff$Product.Category == "Books")])
}
for (i in 1:12){
  eleVec = c(eleVec, sum(dff$Total.Price[(dff$Order.Date > (i - 1) & dff$Order.Date < (i + 1) ) & (dff$Product.Category == "Electronics")]))
  eleVec[i] = eleVec[i] / length(dff$Total.Price[(dff$Order.Date > (i - 1) & dff$Order.Date < (i + 1) ) & (dff$Product.Category == "Electronics")])
}
for (i in 1:12){
  cloVec = c(cloVec, sum(dff$Total.Price[(dff$Order.Date > (i - 1) & dff$Order.Date < (i + 1) ) & (dff$Product.Category == "Clothing")]))
  cloVec[i] = cloVec[i] / length(dff$Total.Price[(dff$Order.Date > (i - 1) & dff$Order.Date < (i + 1) ) & (dff$Product.Category == "Clothing")])
}

monthDf <- data.frame(monthVec, spoVec, homVec, beaVec, booVec, eleVec, cloVec)


reshapedDf <- data.frame(x = monthVec, y = c(monthDf$spoVec, monthDf$homVec, monthDf$beaVec, monthDf$booVec, monthDf$eleVec, monthDf$cloVec), group = c(rep("Sports & Outdoors", nrow(monthDf)), rep("Home & Kitchen", nrow(monthDf)), rep("Beauty & Health", nrow(monthDf)), rep("Books", nrow(monthDf)), rep("Electronics", nrow(monthDf)), rep("Clothing", nrow(monthDf))))

g = ggplot(reshapedDf, aes(x, y, col = group)) + geom_smooth(se = F, method = loess, formula = y~x, span = 1) + labs(title = "Categorized Order Total Averages by Month", x = "Month", y = "Order Total Average")

g
g + ylim(0,800)

```


### Percentage of sales refunded or Cancelled

Another important part of this data set is the amount of refunded and cancelled orders.  Should this be a real business, having a refund and cancel rate of nearly 25% each would be unimaginable.  In the plot below, we can see that the refunded and cancelled orders are nearly level with those of the completed and pending orders.  
```{r comment = NA}
methodGG = ggplot(df, aes(x=Order.Status, fill = Order.Status))+geom_bar() + labs(title = "Order Status Distribution", x = "Order Status", y = "Number of Transactions")
ggplotly(methodGG)

```

```{r echo = F, comment = NA}
statdf = data.frame(Stat = c("Most Frequent Status", "Least Frequent Status", "Range", "Refunded or Cancelled"), Data = c("Pending", "Refunded", "144 Orders", "49.68%"))
#statdf = kable(statdf, format = "latex", booktabs = T, align = '1')
statdf
```


### Most used forms of Payment

Finally, below we have the distribution of payment types that customers used during the 2023 fiscal year.  Similar to the Order Status plot, we observe a similar amount of transactions between all 4 Payment Types with the most used being Paypal.  
```{r comment = NA}
payGG = ggplot(df, aes(x=Payment.Type, fill = Payment.Type))+geom_bar() + labs(title = "Forms of Payment Distribution", x = "Payment Type", y = "Number of Transactions")
ggplotly(payGG)
```

```{r comment = NA, echo = F}
paydf = data.frame(Type = c("Most Used", "Least Used", "Range"), Data = c("Paypal", "Gift Card", "128 Users"))
paydf
```


## Conclusion


In conclusion, the "larger_sales_dataset" by Hassane Skikri produced some interesting results upon data cleaning and wrangling.  We were able to determine that during the fiscal year of 2023, BusA Sales had a total of 10,000 customers.  These customers ordered the most from the categories of Sports & Outdoors and Clothing and the least from Beauty & Health.  They had the highest order totals in the months of October and November, used Paypal the most, and had an almost 50% rate of either returning or cancelling an order.  


While the fields that we observed were realistic, the data seen in this file is highly unlikely to come about during an actual business' operations.  In reality, it is likely that you would expect a higher variance in customer preferences (both categorical and chronological), distribution of sales, and a (hopefully) lower margin of refunded/cancelled orders.  In addition to what we were given in the set, another field that could prove useful towards BusA's endeavors could be a customer satisfaction survey of some sort.  














